<?xml version="1.0" encoding="UTF-8"?>



<deployment xmlns="urn:jboss:bean-deployer:2.0">

   <!-- LAMS TreeCache configuration for JBoss 5 -->

   <!-- First we create a Configuration object for the cache
   		Until a way to exposed it to JNDI is found,
   		this file is not used nor deployed.
   		Treecache.xml is used instead
   		for Hibernate to create a local copy for itself.
    -->

   <bean name="LamsCacheConfig"

         class="org.jboss.cache.config.Configuration">

      <!-- Externally injected services -->  

      <property name="runtimeConfig">

         <bean class="org.jboss.cache.config.RuntimeConfig">

            <property name="transactionManager">

               <inject bean="jboss:service=TransactionManager" 

                       property="TransactionManager"/>

            </property>
            
			<!-- We don't need it
            	<property name="muxChannelFactory"><inject bean="JChannelFactory"/></property>
			-->
         </bean>

      </property>

      

      <property name="multiplexerStack">udp</property>



      <property name="clusterName">TreeCache-Cluster</property>

        

      <property name="isolationLevel">READ_COMMITTED</property>



      <property name="cacheMode">LOCAL</property>



      <property name="stateRetrievalTimeout">15000</property>



      <property name="syncReplTimeout">20000</property>



      <property name="lockAcquisitionTimeout">15000</property>

        

      <property name="exposeManagementStatistics">true</property>

   </bean>

      <!-- Factory to build the Cache. -->

   <bean name="DefaultCacheFactory" class="org.jboss.cache.DefaultCacheFactory" />
   

   <!-- The cache itself. From the Factory we get only Cache interface,
   		not a concrete class, so it can not be exposed to JMX.
   	-->

   <bean name="LamsCache" class="org.jboss.cache.Cache">
	
      <constructor factoryMethod="createCache">

          <factory bean="DefaultCacheFactory"/>

          <parameter class="org.jboss.cache.config.Configuration"><inject bean="LamsCacheConfig"/></parameter>

          <parameter class="boolean">false</parameter>

      </constructor>

          

   </bean>
   
   <!-- JMX Management. This class wraps the Cache object and exposes it to JMX.
   		But the exposed interface is CacheJmxWrapperMBean, not Cache itself,
   		so it can not be used by Hibernate Region Factory.
   	-->

   <bean name="LamsJmxWrapper" class="org.jboss.cache.jmx.CacheJmxWrapper">

      

      <annotation>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name="jboss.cache:service=LamsCache", exposedInterface=org.jboss.cache.jmx.CacheJmxWrapperMBean.class, registerDirectly=true)</annotation>

      

      <constructor>

          <parameter><inject bean="LamsCache"/></parameter>

      </constructor>
     </bean>   
</deployment>