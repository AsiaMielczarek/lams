<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns="*" width="100%" height="100%"
		 xmlns:vos="org.lamsfoundation.lams.vos.*" xmlns:mate="http://mate.asfusion.com/"
		 xmlns:model="org.lamsfoundation.lams.model.*" 
		 xmlns:validate="org.lamsfoundation.lams.validators.*" >
	<mx:Script>
		<![CDATA[
			import com.asfusion.mate.actions.builders.EventAnnouncer;
			
			import mx.binding.utils.BindingUtils;
			import mx.collections.ArrayCollection;
			import mx.controls.Text;
			import mx.controls.ToolTip;
			import mx.core.Application;
			import mx.events.ValidationResultEvent;
			import mx.managers.ToolTipManager;
			import mx.states.State;
			
			import org.lamsfoundation.lams.common.dictionary.XMLDictionaryRegistry;
			import org.lamsfoundation.lams.events.NavigationEvent;
			import org.lamsfoundation.lams.events.WizardEvent;
			
			[Bindable]
			private var lessonList:Array;
			
			[Bindable]
			public var dictionary:XMLDictionaryRegistry;
			
			private function hasFocus(value:Boolean):void {
				if(value) {
					// tab is current selection
					createLessonList();
					if (lessonList.length == 0) {
						enablePrecedingLesson.enabled = false;
					}
				}
			}
			
			private function createLessonList():void {
				var label:String = "";
				var value:String = "";
				
				if(lessonList != null && lessonList.length > 0)
					return;
				
				lessonList = new Array();
				
				// populate organisationLessons list from User (java) class passed through in the Dictionary data.
				var lessonsNumber:uint = uint(dictionary.getValue("lessonsNumber"));
				for (var i:uint = 0; i < lessonsNumber; i++) {
					label = dictionary.getLabel(String('lessonID' + i)) as String;
					value = dictionary.getValue(String('lessonID' + i)) as String;
					
					lessonList.push({label: label, data: value});
				}
				precedingLesson.selectedIndex = 0;
			}
		]]>
	</mx:Script>
	
	<!-- Event Listeners -->
	<mate:Listener type="{NavigationEvent.TAB_SELECT}" receive="hasFocus(event.selectedIndex==Wizard.CONDITIONS_INDEX)" />
	
	<!-- Validators -->
	<validate:LessonValidator id="precedingLessonValidator" source="{this}" property="precedingLessonPicker_fItm"  listener="{precedingLessonPicker_fItm}" errorMessage="{dictionary.getLabel('al.validation.preceding.lesson')}" />
	
	<!-- Model ______________________________________________________________________ -->
	
	<!-- GUI ______________________________________________________________________ -->
	
	<mx:Form id="conditionsForm"  width="100%" height="100%">
		<mx:VBox width="100%" height="100%" paddingLeft="10" paddingRight="10" paddingTop="10" paddingBottom="10">
			<!-- Preceding lesson -->
			<mx:FormHeading id="precedingLesson_fH" label="{dictionary.getLabel('conditions.tab.form.preceding.label')}" />
			<mx:Text width="100%" textAlign="left" selectable="false" text="{dictionary.getLabel('conditions.tab.form.preceding.info.label')}" truncateToFit="true" paddingLeft="6"/>
			<mx:CheckBox id="enablePrecedingLesson" name="enableConditionalLesson" selected="false" label="{dictionary.getLabel('advanced.tab.form.enable.label')}" labelPlacement="right" />
			<mx:VBox width="100%">
				<mx:FormItem id="precedingLessonPicker_fItm" focusEnabled="true">
					<mx:ComboBox id="precedingLesson" editable="false" dataProvider="{lessonList}" enabled="{enablePrecedingLesson.selected}" />
				</mx:FormItem>
			</mx:VBox>
			
			<!-- Time limits -->
			<mx:FormHeading id="timeLimits_fH" label="{dictionary.getLabel('advanced.tab.form.time.limits.label')}"  paddingTop="8"/>
			<mx:Text width="100%" textAlign="left" selectable="false" text="{dictionary.getLabel('advanced.tab.form.time.limits.info.label')}" truncateToFit="true" paddingLeft="6"/>
			<mx:CheckBox id="enableTimeLimits" name="enableTimeLimits" selected="false" label="{dictionary.getLabel('advanced.tab.form.enable.label')}" labelPlacement="right" />
			<mx:VBox width="100%">
				<mx:FormItem id="enableTimeLimits_fItm" label="{dictionary.getLabel('advanced.tab.form.enter.number.days.label')}" enabled="{enableTimeLimits.selected}" focusEnabled="true">
					<mx:NumericStepper id="noDaysToLessonFinish" value="30" minimum="1" maximum="999"/>
				</mx:FormItem>
				<mx:CheckBox id="enableIndividualTimeLimit" selected="false" enabled="{enableTimeLimits.selected}" label="{dictionary.getLabel('advanced.tab.form.individual.not.entire.group.label')}" labelPlacement="right" />
			</mx:VBox>
		</mx:VBox>
	</mx:Form>
	
</mx:VBox>
