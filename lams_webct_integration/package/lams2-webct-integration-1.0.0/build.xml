<?xml version="1.0" encoding="UTF-8"?>
<project default="deploy-files" name="LAMS/WebCt Integration Deployer" basedir="./">
	
	
	<property file="build.properties" />
	<property file="db/conf/${dbType}.properties" />
	<property name="deploy.dir" value="${webctDeployableComponentsDir}/lams2"/>
	<property name="lib" value="lib"/>
	<property name="build.deploy" value="deploy/" />
	<property name="product" value="lams2-webct-integration"/>
	<property name="version" value="1.0.0"/>
	<property name="jar" value="${product}-${version}.jar"/>
	<property name="jarfile" value="${deploy.dir}/${jar}"/>
	
	<target name="deploy-files" depends="clean, filter-config, jar">
		<mkdir dir="${deploy.dir}"/>
		<copy todir="${deploy.dir}" overwrite="true">	
			<fileset dir="lib">
				<include name="authmoduledata_ce_1.4.jar"/>
				<include name="commons-codec-1.3.jar"/>
				<include name="mysql-connector-java-3.1.12-bin.jar"/>
				<include name="xercesImpl.jar" />
		   	</fileset>
		</copy>
	</target>
	
	<target name="clean">
		<delete includeEmptyDirs="true" quiet="true" failonerror="false">
			<fileset dir="${deploy.dir}"/>
		</delete>
		<mkdir dir="${deploy.dir}"/>
	</target>
	
	<target name="filter-config">
		
		<delete file="${build.deploy}/web/lib/tigra/tree_tpl.js" failonerror="false" />  
		<delete file="${build.deploy}/" failonerror="false" />
				
		<copy todir="${build.deploy}/web/lib/tigra" overwrite="true">	
			<fileset dir="${basedir}">
				<include name="tree_tpl.js"/>
		   	</fileset>
			<filterset>
				<filter token="imgUrl" value="${imgUrl}" />
			</filterset>
		</copy>
		
		<copy todir="${build.deploy}" overwrite="true">	
			<fileset dir="${basedir}">
				<include name="DeployableComponentConfig.xml"/>
		   	</fileset>
			<filterset>
				<filter token="dbUrl" value="${dbUrl}" />
   				<filter token="dbPort" value="${dbPort}" />
   				<filter token="dbName" value="${dbName}" />
   				<filter token="dbUser" value="${dbUser}" />
   				<filter token="dbDriver" value="${dbDriver}" />
   				<filter token="dbTable" value="${dbTable}" />
   				<filter token="dbPass" value="${dbPass}" />
   				<filter token="lamsServerUrl" value="${lamsServerUrl}" />
   				<filter token="serverId" value="${serverId}" />
   				<filter token="secretKey" value="${secretKey}" />
   				<filter token="reqSrc" value="${reqSrc}" />
   				<filter token="imgUrl" value="${imgUrl}" />
			</filterset>
		</copy>
	</target>
	
	<target name="jar">
		<jar destfile="${jarfile}"
			basedir="${build.deploy}"
			excludes="**/CVS"
		/>
	</target>
	
	<target name="create-table">
			<echo>${dbUrl}</echo>
			
			<sql 
				driver="${dbDriver}"
				classpath="${dbDriverClassPath}"
				url="${dbUrl}"
				userid="${dbUser}"
				password="${dbPass}"
				encoding="utf8"
			>
				<transaction src="db/sql/createTable_${dbType}.sql" />
			</sql>	
	</target>
	
	<target name="delete-table">
			<sql 
				driver="${dbDriver}"
				classpath="${dbDriverClassPath}"
				url="${dbUrl}"
				userid="${dbUser}"
				password="${dbPass}"
				encoding="utf8"
			>
				<transaction src="db/sql/deleteTable_${dbType}.sql" />
			</sql>	
	</target>
	
</project>